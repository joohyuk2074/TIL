# DB 설계 규칙 6가지

## 5. 가짜 중복과 진짜 중복을 구별해라
데이터베이스 설계 시 데이터를 중복 제거해야 하지만, 중복으로 보이는 데이터가 항상 잘못된 것은 아니다. 따라서, 데이터가 **가짜 중복**인지, **진짜 중복**인지 구별하는 것이 중요하다.

### 가짜 중복과 진짜 중복의 차이
- **가짜 중복:** 데이터가 반복적으로 나타나지만, 서비스 상에서 별개의 데이터로 취급되어야 한다.
- **진짜 중복:** 동일한 데이터가 반복적으로 저장되어 수정 시 다른 데이터도 영향을 받아야 한다.

> 가짜 중복인지 진짜 중복인지 판단하려면 이렇게 질문해보면 된다.
> 
> **“실제 서비스에서 A 데이터의 값을 수정하면, B 데이터의 값도 같이 수정되어야 하는가?”**

---

### **예시 1: 고객의 주문 내역**
**[잘못된 설계: 모든 주문에서 고객 이름을 저장]**

**orders (주문)**

| id (PK) | 고객 이름 | 주문 상품 | 주문 날짜  |
|---------|-----------|-----------|------------|
| 1       | 김철수    | 노트북    | 2024-01-01 |
| 2       | 김철수    | 마우스    | 2024-01-02 |
| 3       | 이영희    | 스마트폰  | 2024-01-03 |

- **문제점:** 고객 이름이 여러 주문에서 반복적으로 저장됨.  
- **진짜 중복인지 확인:** 만약 김철수의 이름을 "김영수"로 수정한다면, 모든 주문 내역에서도 수정되어야 함.  
  - 결과: **진짜 중복** → 고객 정보를 별도 테이블로 분리해야 함.

**[분리 후 설계]**

**customers (고객)**

| id (PK) | 이름    |
|---------|---------|
| 1       | 김철수  |
| 2       | 이영희  |

**orders (주문)**

| id (PK) | 고객 id (FK) | 주문 상품 | 주문 날짜  |
|---------|--------------|-----------|------------|
| 1       | 1            | 노트북    | 2024-01-01 |
| 2       | 1            | 마우스    | 2024-01-02 |
| 3       | 2            | 스마트폰  | 2024-01-03 |

- **해결:** 고객 이름을 수정하면 모든 주문 내역에서 변경 사항이 반영됨.

---

### **예시 2: 제품의 주문 기록**
**[잘못된 설계: 제품 이름이 중복 저장]**

**orders (주문)**

| id (PK) | 제품명      | 수량  | 주문 날짜  |
|---------|-------------|-------|------------|
| 1       | 노트북      | 1     | 2024-01-01 |
| 2       | 노트북      | 2     | 2024-01-02 |
| 3       | 스마트폰    | 1     | 2024-01-03 |

- **문제점:** 제품명이 여러 주문에서 반복적으로 저장됨.
- **진짜 중복인지 확인:** 만약 "노트북" 이름을 "울트라 노트북"으로 변경하면 모든 주문 기록에서 변경되어야 함.  
  - 결과: **진짜 중복** → 제품 정보를 별도 테이블로 분리해야 함.

**[분리 후 설계]**

**products (제품)**

| id (PK) | 제품명      |
|---------|-------------|
| 1       | 노트북      |
| 2       | 스마트폰    |

**orders (주문)**

| id (PK) | 제품 id (FK) | 수량  | 주문 날짜  |
|---------|--------------|-------|------------|
| 1       | 1            | 1     | 2024-01-01 |
| 2       | 1            | 2     | 2024-01-02 |
| 3       | 2            | 1     | 2024-01-03 |

- **해결:** 제품 이름을 변경하면 모든 주문 내역에 자동으로 반영됨.

---

### **예시 3: 주문 내역에서 할인 쿠폰**
**[잘못된 설계: 쿠폰 정보 중복 저장]**

**orders (주문)**

| id (PK) | 주문자 | 쿠폰 코드  | 할인 금액 |
|---------|--------|------------|-----------|
| 1       | 김철수 | SAVE10     | 10,000    |
| 2       | 이영희 | SAVE10     | 10,000    |
| 3       | 박지훈 | SAVE20     | 20,000    |

- **문제점:** 쿠폰 정보가 여러 주문에서 반복적으로 저장됨.
- **진짜 중복인지 확인:** "SAVE10" 쿠폰의 할인 금액이 변경되면 모든 주문 내역에 반영되어야 함.  
  - 결과: **진짜 중복** → 쿠폰 정보를 별도 테이블로 분리해야 함.

**[분리 후 설계]**

**coupons (쿠폰)**

| id (PK) | 쿠폰 코드 | 할인 금액 |
|---------|-----------|-----------|
| 1       | SAVE10    | 10,000    |
| 2       | SAVE20    | 20,000    |

**orders (주문)**

| id (PK) | 주문자  | 쿠폰 id (FK) |
|---------|---------|--------------|
| 1       | 김철수  | 1            |
| 2       | 이영희  | 1            |
| 3       | 박지훈  | 2            |

- **해결:** 쿠폰 할인 금액을 변경하면 모든 주문 내역에서 자동으로 반영됨.

---

### 정리
**가짜 중복인지 진짜 중복인지 판단 질문**
1. 데이터 A와 B가 동일하다면, 데이터 A를 변경했을 때 B도 변경되어야 하는가?
   - **YES:** 진짜 중복 → 테이블 분리.
   - **NO:** 가짜 중복 → 분리 필요 없음.

이 과정을 통해 데이터 중복을 제대로 관리하면 저장 공간을 절약하고, 데이터 무결성을 유지하며, 유지보수 비용을 줄일 수 있다.
